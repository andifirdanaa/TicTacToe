<!-- SCRIPT -->
<script defer type="text/javascript">


    $(document).ready(function () {

        $('.layout_list_history_transaksi').addClass('hide')
        $('.regDashboard').addClass('hide')

        var hargajualreal = <%= @hargaJual.to_i * 100 %>;
        var nilaiGram = parseFloat(50000) / hargajualreal;

        $("#id_buyInRupiah").val(50000)
        $("#id_buyInGram").val(nilaiGram.toFixed(4))



        // MENU
        $('#beli_emas').click(function () {

            var btnBeli = document.getElementById("beli_emas");
            btnBeli.style.backgroundColor = "white";
            btnBeli.style.color = "#69C16C";


            var btnJual = document.getElementById("jual_emas");
            btnJual.style.backgroundColor = "#69C16C";
            btnJual.style.color = "white";

            $('.history_box').addClass('hide')
            $('.layoutBanner').addClass('hide')
            $('.jual_box').addClass('hide')
            $('.beli_box').removeClass('hide')
            $('.input_beli').removeClass('hide')
            $('.inquiry_beli').addClass('hide')
            $('.input_pass_beli').addClass('hide')

        })

        $('#jual_emas').click(function () {

            var btnBeli = document.getElementById("beli_emas");
            btnBeli.style.backgroundColor = "#69C16C";
            btnBeli.style.color = "white";


            var btnJual = document.getElementById("jual_emas");
            btnJual.style.backgroundColor = "white";
            btnJual.style.color = "#69C16C";

            $('.history_box').addClass('hide')
            $('.layoutBanner').addClass('hide')
            $('.beli_box').addClass('hide')
            $('.jual_box').removeClass('hide')
        })

        $('#nama').click(function () {
            $('.layoutBanner').removeClass('hide')

            $('.history_box').removeClass('hide')
            $('.beli_box').addClass('hide')
            $('.jual_box').addClass('hide')
        })

        $('#id_backJualEmas').click(function () {

            var btnBeli = document.getElementById("beli_emas");
            var btnJual = document.getElementById("jual_emas");
            btnBeli.style.backgroundColor = "#69C16C";
            btnJual.style.backgroundColor = "#69C16C";
            btnBeli.style.color = "white";
            btnJual.style.color = "white";

            $('.history_box').removeClass('hide')
            $('.layoutBanner').removeClass('hide')

            $('.beli_box').addClass('hide')
            $('.jual_box').addClass('hide')
        });





    })

    $('#pendaftaran').click(function () {

        // alert('a')

        $('.regDashboard').removeClass('hide')
        $('.mainDashboard').addClass('hide')
        $('.layout_sukses_gagal').removeClass('hide')


    });

    // ============================ START REGISTRASI NASABAH


    $('#id_lanjutRegis').click(function () {

        $('.layout_loading').removeClass('hide')
        $('.regDashboard').addClass('hide')

        var token = '<%=params['token']%>';

        var amount = $("#amount").val();
        var ibuKandung = $("#ibuKandung").val();
        var idKelurahan = $("#idKelurahan").val();
        var alamat = $("#jalan").val();
        var kelamin = $("#jenisKelamin").val();
        var nama = $("#namaNasabah").val();
        var noHp = $("#id_noHp").val();
        var noIdentitas = $("#noIdentitas").val();
        var reffSwitching = $("#reffSwitching").val();
        var statusKawin = $("#statusKawin").val();
        var tanggalLahir = $("#tglLahir").val();
        var tempatLahir = $("#tempatLahir").val();

        $.ajax({
            url: '/frontend/home/' + "regis_nasabah" + "?token=" + token,
            type: 'POST',
            dataType: "json",

            data: {

                amount: amount,
                ibuKandung: ibuKandung,
                idKelurahan: idKelurahan,
                alamat: alamat,
                kelamin: kelamin,
                nama: nama,
                noHp: noHp,
                noIdentitas: noIdentitas,
                reffSwitching: reffSwitching,
                statusKawin: statusKawin,
                tanggalLahir: tanggalLahir,
                tempatLahir: tempatLahir,

            },

            beforeSend: function () {
                //  $('.modal_json').fadeIn('fast');
            },
            success: function (data) {

                $('.layout_loading').addClass('hide')


                console.log(data)
                // console.log(data.status)

                if (data == null) {

                    $('.regDashboard').addClass('hide')
                    $('.layout_sukses_gagal_registrasi').removeClass('hide')
                    $('.layout_gagal_regis').removeClass('hide')

                } else {

                    if (data.status == true) {

                        $('.regDashboard').addClass('hide')
                        $('.layout_sukses_gagal_registrasi').removeClass('hide')
                        $('.layout_sukses_regis').removeClass('hide')


                    } else {

                        $('.regDashboard').addClass('hide')
                        $('.layout_sukses_gagal_registrasi').removeClass('hide')
                        $('.layout_gagal_regis').removeClass('hide')

                    }

                }

            },
            error: function () {
                $('#mycontent').html("")
            },
            complete: function () { }
        });

    });


    // ============================ END REGISTRASI NASABAH


    // ============================ START HISTORI TRANSAKSI

    function cekHistory() {

        $('.layout_loading').removeClass('hide')
        $('.mainDashboard').addClass('hide')

        var token = '<%=params['token']%>';

        $.ajax({
            url: '/frontend/home/' + "list_history_transaksi" + "?token=" + token,
            dataType: 'html',

            beforeSend: function () {
                //  $('.modal_json').fadeIn('fast');
            },
            success: function (data) {

                $('#id_regDashboard').hide()
                $('#list_history_transaksi').show()
                $('#list_history_transaksi').html(data)

                $('.layout_loading').addClass('hide')

                console.log(data)

            },
            error: function () {
                $('#mycontent').html("")
            },
            complete: function () { }
        });


    }

    // ============================ END HISTORI TRANSAKSI

    function autoConvertGram() {

        var valx = $("#id_buyInRupiah").val();
        var hargajualreal = <%= @hargaJual.to_i * 100 %>;


        var nilaiTransaksi = valx.replace(/[^0-9]/g, '');
        var nilaiGram = parseFloat(nilaiTransaksi) / hargajualreal;

        $("#id_buyInRupiah").val(formatRupiah(valx.toString(), ""));
        $("#id_buyInGram").val(nilaiGram.toFixed(4));

        console.log("NILAI GRAM ========>" + nilaiGram + "<||>" + valx)
        console.log("NILAI RP ========>" + formatRupiah(valx.toString(), ""))


    }

    function autoConvertRupiah(val) {

        var hargajualreal = <%= @hargaJual.to_i * 100 %>;
        var nilaiGram = parseFloat(val) / hargajualreal;


        // $("#id_buyInRupiah").val(formatRupiah(nilaiGram.toString(), ""))
        $("#id_buyInGram").val(val)

    }

    $("#id_lanjutBeliEmas").click(function () {


        var token = '<%=params['token']%>';

        var nilaiTransaksiStr = $('#id_buyInRupiah').val();

        var nilaiTransaksi = nilaiTransaksiStr.replace(/[^0-9]/g, '');

        var grEmas = $("#id_buyInGram").val()
        var rpEmas = $("#id_buyInRupiah").val()
        var totBuy = $("#id_buyInRupiah").val()
        var noRek = $("#id_norek").val();

        var nilaiTransaksiInt = parseFloat(nilaiTransaksi)

        console.log("nilaiTransaksiStr ====>" + nilaiTransaksiStr)
        console.log("nilaiTransaksi ====>" + nilaiTransaksi)
        console.log("nilaiTransaksiInt ====>" + nilaiTransaksiInt)

        if (nilaiTransaksi == "0" || nilaiTransaksi == "" || nilaiTransaksi == "NaN") {
            toastr.error('Silahkan masukkan Nilai Pembelian Emas ..!', 'Warnning!!')
            return false;
        } else if (nilaiTransaksiInt < 50000) {
            toastr.error('Pembelian Emas Minimal Rp. 50.000 ', 'Warnning!!')
            return false;
        } else {

        }

        var saldoDigi = <%= @saldo_digi.to_i %>;

        if (saldoDigi < nilaiTransaksiInt) {

            toastr.error('Saldo PNM Digi anda tidak cukup untuk pembelian Emas ..!', 'Warnning!!')
            return false;

        } else {

        }

        $('.layout_loading').removeClass('hide')
        $('.mainDashboard').addClass('hide')

        $.ajax({
            url: '/frontend/home/' + "inqury_pembelian" + "?token=" + token + "&norek=" + noRek + "&nilaitrans=" + nilaiTransaksi,
            dataType: 'json',
            beforeSend: function () {
                //  $('.modal_json').fadeIn('fast');
            },
            success: function (datax) {

                console.log(datax)

                if (datax.status == false) {

                    $('.layout_loading').addClass('hide')
                    $('.mainDashboard').addClass('hide')

                    $("#id_msg").text(datax.message);

                    $('.layout_sukses_gagal').removeClass('hide')
                    $('.layout_gagal').removeClass('hide')

                } else {

                    // alert('ada')

                    data = datax.payload;

                    // TODO: CEK datax.status
                    $('#amountx').val(data.nilaiTransaksi)
                    $('#gramx').val(data.gram)
                    $('#hargax').val(data.harga)
                    $('#norekx').val(data.norek)
                    $('#reffSwitchingx').val(data.reffSwitching)
                    $('#totalKewajibanx').val(data.totalKewajiban)

                    $("#nilaitrans").text(formatRupiah(data.nilaiTransaksi.toString(), ""));
                    $("#jumlahemas").text(data.gram);
                    $("#jumlahemas_rupiah").text(formatRupiah(data.nilaiTransaksi.toString(), ""));

                    $('.layout_loading').addClass('hide')
                    $('.mainDashboard').removeClass('hide')
                    $('.input_beli').addClass('hide')
                    $('.inquiry_beli').removeClass('hide')

                }


            },
            error: function () {
                $('#mycontent').html("")
            },
            complete: function () { }
        });
    });

    $("#id_backBeliEmas").click(function () {

        var btnBeli = document.getElementById("beli_emas");
        var btnJual = document.getElementById("jual_emas");
        btnBeli.style.backgroundColor = "#69C16C";
        btnJual.style.backgroundColor = "#69C16C";
        btnBeli.style.color = "white";
        btnJual.style.color = "white";

        $('.input_beli').addClass('hide')
        $('.beli_box').addClass('hide')
        $('.history_box').removeClass('hide')
        $('.layoutBanner').removeClass('hide')

    });

    $("#id_backBayarEmas").click(function () {
        $('.input_beli').removeClass('hide')
        $('.beli_box').removeClass('hide')
        $('.inquiry_beli').addClass('hide')

    });
    
    $("#id_backBayarEmasKu").click(function () {
        location.reload()


    });

    $("#id_backconfirm_pass_penjualan").click(function () {
        location.reload()
    });

    $("#id_lanjutBayarEmas").click(function () {

        $('.mainDashboard').addClass('hide')
        $('.input_pass_beli').removeClass('hide')

    });

    $("#id_backconfirm_pass").click(function () {

        $('#list_history_transaksi').hide();
        var token = '<%=params['token']%>';
        location.href = '/frontend/?token=' + token;

    });

    $("#id_showAllHist").click(function () {

        $('.mainDashboard').addClass('hide')
        $('.layout_list_history_transaksi').removeClass('hide')

    });

    // KONFIRMASI PASSWORD PEMBELIAN EMAS

    function showEyePass() {

        var x = document.getElementById("passBeliEmasID");
        if (x.type === "password") {
            x.type = "text";
        } else {
            x.type = "password";
        }
    }

    $("#id_confirm_pass").click(function () {


        pass = $('#passBeliEmasID').val();
        $('#passBeliEmasID').focus();

        $('#id_confirm_pass').html("harap tunggu...")

        if (pass == '') {

            $('#id_confirm_pass').html("Lanjut")
            toastr.error('Silahkan masukkan password transaksi..!', 'Warnning!!')
            return false;

        } else {

            var token = '<%=params['token']%>';
            var passSess = '<%= @password %>';
            passx = $('#passBeliEmasID').val();

            $.ajax({

                type: 'GET',
                url: '/frontend/home/encryptPass?token=' + token,
                data: {
                    mypass: passx
                },
                dataType: 'json',
                success: function (passEncryptCheck) {

                    var pss = passEncryptCheck.data;
                    console.log(passEncryptCheck)
                    // res = pss.replace("+", " ");
                    // console.log(res)

                    if (passSess.replace(/ /g, "+") != pss.replace(/ /g, "+")) {

                        $('#id_confirm_pass').html("Lanjut")
                        toastr.error('Password yang anda masukkan salah..!', 'Warnning!!')
                        return false;

                    } else {

                        $('.layout_loading').removeClass('hide')
                        $('.mainDashboard').addClass('hide')
                        $('.input_pass_beli').addClass('hide')

                        var token = '<%=params['token']%>';

                        var amount = $('#amountx').val();
                        var gram = $('#gramx').val();
                        var harga = $('#hargax').val();
                        var norek = $('#norekx').val();
                        var reffSwitching = $('#reffSwitchingx').val();
                        var totalKewajiban = $('#totalKewajibanx').val();


                        $.ajax({
                            url: '/frontend/home/' + "topup_pembelian" + "?token=" + token,
                            type: 'POST',
                            dataType: "json",

                            data: {

                                amount: amount,
                                gram: gram,
                                harga: harga,
                                norek: norek,
                                reffSwitching: reffSwitching,
                                totalKewajiban: totalKewajiban,

                            },

                            beforeSend: function () {
                                //  $('.modal_json').fadeIn('fast');
                            },
                            success: function (data) {

                                $('.layout_loading').addClass('hide')

                                console.log(data)
                                console.log(data.status)

                                if (data.status == true) {

                                    datapay = data.payload;

                                    console.log(datapay)
                                    console.log(datapay.tglTransaksi)


                                    // TODO: CEK datax.status
                                    var pay_tglTransaksi = datapay.tglTransaksi;
                                    var numbers = pay_tglTransaksi.match(/\d+/g);
                                    var datex_tglTransaksi = numbers[1] + "-" + numbers[2] + "-" + numbers[0];

                                    $('#pay_tglTransaksi').text(datex_tglTransaksi)
                                    $('#pay_reffSwitching').text(datapay.reffSwitching)
                                    $('#pay_norek').text(datapay.norek)
                                    $('#pay_namaNasabah').text(datapay.namaNasabah)
                                    $('#pay_gram').text(datapay.gram)
                                    $('#pay_harga').text(formatRupiah(datapay.harga, ""))
                                    $('#pay_nilaiTransaksi').text(formatRupiah(datapay.nilaiTransaksi, ""))

                                    $('.mainDashboard').addClass('hide')
                                    $('.input_pass_beli').addClass('hide')
                                    $('.layout_sukses_gagal').removeClass('hide')
                                    $('.layout_sukses').removeClass('hide')

                                } else {

                                    $('.mainDashboard').addClass('hide')
                                    $('.input_pass_beli').addClass('hide')
                                    $('.layout_sukses_gagal').removeClass('hide')
                                    $('.layout_gagal').removeClass('hide')
                                    $('.layout_sukses').addClass('hide')

                                }

                            },
                            error: function () {
                                $('#mycontent').html("")
                            },
                            complete: function () { }
                        });

                    }

                },
            });

        }

    });

    $("#id_confirm_pass_penjualan").click(function () {


        pass = $('#passJualEmasID').val();
        console.log(pass);
        $('#passBeliEmasID').focus();

        $('#id_confirm_pass_penjualan').html("harap tunggu...")

        if (pass == '') {

            $('#id_confirm_pass_penjualan').html("Lanjut")
            toastr.error('Silahkan masukkan password transaksi..!', 'Warnning!!')
            return false;

        } else {

            var token = '<%=params['token']%>';
            var passSess = '<%= @password %>';
            passx = $('#passJualEmasID').val();
            console.log(passx);

            $.ajax({

                type: 'GET',
                url: '/frontend/home/encryptPass?token=' + token,
                data: {
                    mypass: passx
                },
                dataType: 'json',
                success: function (passEncryptCheck) {

                    var pss = passEncryptCheck.data;
                    console.log(passEncryptCheck)
                    // res = pss.replace("+", " ");
                    // console.log(res)

                    if (passSess.replace(/ /g, "+") != pss.replace(/ /g, "+")) {

                        $('#id_confirm_pass_penjualan').html("Lanjut")
                        toastr.error('Password yang anda masukkan salah..!', 'Warnning!!')
                        return false;

                    } else {

                        $('.layout_loading').removeClass('hide')
                        $('.mainDashboard').addClass('hide')
                        $('.input_pass_jual').addClass('hide')

                        var token = '<%=params['token']%>';

                       
                        var gram = $("#id_saleInGram").val()
                        var harga = $("#hargaJual").val()
                        

                        
                        var norek = $('#id_norek').val();
                        var reffSwitching = $('#reffSwitching').val();
                        var tujuan = $('#tujuan').val();
                        var totalKewajiban = $('#totalKewajiban').val();


//alert(harga);

                        $.ajax({
                            url: '/frontend/home/' + "buy_back" + "?token=" + token,
                            type: 'POST',
                            dataType: "json",

                            data: {

                                gram: gram,
                                harga: harga,
                                norek: norek,
                                reffSwitching: reffSwitching,
                                tujuan: tujuan,
                                totalKewajiban: totalKewajiban

                            },

                            beforeSend: function () {
                                //  $('.modal_json').fadeIn('fast');
                            },
                            success: function (data) {

                                $('.layout_loading').addClass('hide')

                                 console.log("=====================================> console Buyback")
                                console.log(data)
                                console.log(data.status)


                                
                                if (data.status == true) {

                                    databuy = data.payload;

                                    console.log(databuy)
                                    
                                    $('#buyback_tglTransaksi').text(databuy.tglTransaksi)
                                    $('#buyback_reffSwitching').text(databuy.reffSwitching)
                                    $('#buyback_walletID').text(databuy.tujuan)
                                    $('#buyback_norek').text(databuy.norek)
                                    $('#buyback_namaNasabah').text(databuy.namaNasabah)
                                    $('#buyback_gram').text(databuy.gramTransaksi)
                                    
                                    $('#buyback_nilaiTransaksi').text(formatRupiah(databuy.nilaiTransaksi.toString(), ""))
                                    var ttl = databuy.nilaiTransaksi-10000
                                    $('#total_buyback_nilaiTransaksi').text(formatRupiah(ttl.toString(), ""))

                                    $('.mainDashboard').addClass('hide')
                                    $('.input_pass_jual').addClass('hide')
                                    $('.layout_sukses_gagal_jual').removeClass('hide')
                                    $('.layout_sukses').removeClass('hide')

                                } else {

                                    // alert('sebbee');
                                    console.log('+++++++++++++++++++++data.message');
                                    console.log(data.message);
                                    $('.mainDashboard').addClass('hide')
                                    $('.input_pass_jual').addClass('hide')
                                    $('.layout_sukses_gagal_jual').removeClass('hide')
                                    $('.layout_gagal').removeClass('hide')
                                    $('.layout_sukses').addClass('hide')
                                    $('#layout_gagal #id_msg').html('Transaksi kamu gagal..! '+data.message)

                                }
                                
                            },
                            error: function () {
                                $('#mycontent').html("")
                            },
                            complete: function () { }
                        });










                        // toastr.success('Yeay Berhasil gan..!', 'Berhasil donk!!')
                        //$('.mainDashboard').addClass('hide')
                        //$('.input_pass_jual').addClass('hide')
                        //$('.layout_sukses_gagal_jual').removeClass('hide')
                        //$('.layout_sukses').removeClass('hide')
                       

                    }

                },
            });

        }

    });



    function gotToDashboard() {

        $('#list_history_transaksi').hide();

        var token = '<%=params['token']%>';
        location.href = '/frontend/?token=' + token;

    }


    function numberWithCommas(x) {
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }


    /* Fungsi formatRupiah */
    function formatRupiah(angka, prefix) {
        var number_string = angka.replace(/[^,\d]/g, "").toString(),
            split = number_string.split(","),
            sisa = split[0].length % 3,
            rupiah = split[0].substr(0, sisa),
            ribuan = split[0].substr(sisa).match(/\d{3}/gi);

        // tambahkan titik jika yang di input sudah menjadi angka ribuan
        if (ribuan) {
            separator = sisa ? "." : "";
            rupiah += separator + ribuan.join(".");
        }

        rupiah = split[1] != undefined ? rupiah + "," + split[1] : rupiah;
        return prefix == undefined ? rupiah : rupiah ? " " + rupiah : "";
    }



   




    //================================= jual emas =====================================================
    function autoConvertGramJual_Up() {
        var valx = $("#id_saleInRupiah").val();
        var hargajualreal = <%= @hargaBeli.to_i * 100 %>;
        var nilaiTransaksi = valx.replace(/[^0-9]/g, '');

        var nilaiGram = parseFloat(nilaiTransaksi) / hargajualreal;
        var saldoEmas = <%= @tabungan['saldo'].to_f%>;
        // alert(parseFloat(nilaiTransaksi));

        if (valx == "0" || valx == " " || valx == "NaN" || valx == "") {
            $("#id_saleInGram").val(0);
        }else{
            $("#id_saleInGram").val(nilaiGram.toFixed(4));
        }

            $("#id_saleInRupiah").val(formatRupiah(valx.toString(), ""));
            // $("#id_saleInGram").val(nilaiGram.toFixed(4));
            $("#jual_semua").prop("checked", false);
        
    }

    function autoConvertGramJual_Change() {
        var valx = $("#id_saleInRupiah").val();
        var hargajualreal = <%= @hargaBeli.to_i * 100 %>;
        var nilaiTransaksi = valx.replace(/[^0-9]/g, '');
        var nilaiGram = parseFloat(nilaiTransaksi) / hargajualreal;
        var saldoEmas = <%= @tabungan['saldo'].to_f%>;
        
        if (valx == "0" || valx == " " || valx == "NaN" || valx == "") {
            $("#id_saleInGram").val(0);
        }else{
            $("#id_saleInGram").val(nilaiGram.toFixed(4));
        }

        if (nilaiGram < 1) {
            $("#jual_semua").prop("checked", false);
            toastr.error('Minimal Penjualan Emas 1 gram', 'Warnning!!')
            $("#id_saleInRupiah").val(0);
            // $("#id_saleInGram").val(0);
            $("#jual_semua").prop("checked", false);
        }else{
            $("#id_saleInRupiah").val(formatRupiah(valx.toString(), ""));
            // $("#id_saleInGram").val(nilaiGram.toFixed(4));
            $("#jual_semua").prop("checked", false);              
        }
    }

    function autoConvertRupiahJual(val) {
        var hargajualreal = <%= @hargaJual.to_i * 100 %>;
        var nilaiGram = parseFloat(val) / hargajualreal;
        $("#id_saleInGram").val(val)
    }


    function autoConvertRupiahJualAll(checkbox) {
        var valx = <%= @tabungan['saldo'].to_f%>;
        var hargajualreal = <%= @hargaBeli.to_i * 100 %>;
        var nilaiBeli = valx * hargajualreal;
        var jual_semua = $("#jual_semua").val();

        if(checkbox.checked == true){
            $("#id_saleInRupiah").val(formatRupiah(nilaiBeli.toString(), ""));
            $("#id_saleInGram").val(valx.toString());
        }else{
            $("#id_saleInRupiah").val(0);
            $("#id_saleInGram").val(0);
        }

    

    }
    


    $("#id_lanjutJualEmas").click(function () {
        
        var token = '<%=params['token']%>';
        var nilaiTransaksiStr = $('#id_saleInRupiah').val();
        var nilaiTransaksi = nilaiTransaksiStr.replace(/[^0-9]/g, '');
        var grEmas = $("#id_saleInGram").val()
        var rpEmas = $("#id_saleInRupiah").val()
        var totBuy = $("#id_saleInRupiah").val()
        var noRek = $("#id_norek").val();
        var nilaiTransaksiInt = parseFloat(nilaiTransaksi)
        
        //alert(grEmas);

        console.log("nilaiTransaksiStr ====>" + nilaiTransaksiStr)
        console.log("nilaiTransaksi ====>" + nilaiTransaksi)
        console.log("nilaiTransaksiInt ====>" + nilaiTransaksiInt)
        console.log("nilaiTransaksiInt ====>" + grEmas)
        

        if (nilaiTransaksi == "0" || nilaiTransaksi == "" || nilaiTransaksi == "NaN") {
            toastr.error('Silahkan masukkan Nilai Pembelian Emas ..!', 'Warnning!!')
            return false;
        } else if (nilaiTransaksiInt < 50000) {
            toastr.error('Pembelian Emas Minimal Rp. 50.000 ', 'Warnning!!')
            return false;
        } else {

        }

        // var saldoDigi = <%= @saldo_digi.to_i %>;

        // if (saldoDigi < nilaiTransaksiInt) {

        //     toastr.error('Saldo PNM Digi anda tidak cukup untuk pembelian Emas ..!', 'Warnning!!')
        //     return false;

        // } else {

        // }

        $('.layout_loading').removeClass('hide')
        $('.mainDashboard').addClass('hide')

        $.ajax({
            // url: '/frontend/home/' + "inqury_pembelian" + "?token=" + token + "&norek=" + noRek + "&nilaitrans=" + nilaiTransaksi,
            url: '/frontend/home/' + "inquiry_penjualan" + "?token=" + token + "&norek=" + noRek + "&gram=" + grEmas + "&harga=" + nilaiTransaksiInt,
            // url: '/frontend/home/' + "inquiry_penjualan" + "?token=" + token,
            dataType: 'json',
            beforeSend: function () {
                //  $('.modal_json').fadeIn('fast');
            },
            success: 
            function (datax) {
            
                console.log(datax);

                if (datax.status == false) {

                    $('.layout_loading').addClass('hide')
                    $('.mainDashboard').addClass('hide')

                    $("#id_msg").text(datax.message);

                    $('.layout_sukses_gagal').removeClass('hide')
                    $('.layout_gagal').removeClass('hide')

                } else {

                    // alert('ada')

                    data = datax.payload;
                    console.log(datax.payload)
                    // TODO: CEK datax.status
                    // var total_terima = valx * hargajualreal;
                    
                    $("#gramTransaksi").text(data.gramTransaksi);
                    $("#nilaiTransaksi").text(formatRupiah(data.nilaiTransaksi.toString(), ""));
                    var nilaijual = data.nilaiTransaksi-10000
                    $("#nilaitransJual").text(formatRupiah(nilaijual.toString(), ""));
                    
                    $('#reffSwitching').val(data.reffSwitching);
                    $('#tujuan').val(data.tujuan);
                    $('#norek').val(data.norek);
                    $('#totalKewajiban').val(data.totalKewajiban);
                    $('#hargaJual').val(data.nilaiTransaksi);

                    $('.layout_loading').addClass('hide')
                    $('.mainDashboard').removeClass('hide')
                    $('.input_jual').addClass('hide')
                    $('.inquiry_jual').removeClass('hide')

                }


            },
            error: function () {
                $('#mycontent').html("")
            },
            complete: function () { }
        });
    });
    

    $("#id_lanjutPenjualanEmas").click(function () {
        // alert('in2');
        $('.mainDashboard').addClass('hide')
        $('.input_pass_jual').removeClass('hide')

    });

    
    function autoConvertGramJual_min(){
        var nilaiTransaksiStr = $('#id_saleInGram').val();
        var gram_plus = 0.5;
        var hargajualreal = <%= @hargaBeli.to_i * 100 %>;
       
        if(nilaiTransaksiStr == '1'){
            var total = parseFloat(nilaiTransaksiStr);
            var hargaJualEmas = parseFloat(total) *parseFloat(hargajualreal);
        }else{
            var total = parseFloat(nilaiTransaksiStr) - gram_plus;
            var hargaJualEmas = parseFloat(total) *parseFloat(hargajualreal);

        }
        
       
        $('#id_saleInGram').val(total);
        $('#id_saleInRupiah').val(hargaJualEmas);
        $('#lbl_saleGram').text(total+' Gr');
        $("#lbl_saleRupiah").text("Rp. "+formatRupiah(hargaJualEmas.toString(), ""));
        

    }

    function autoConvertGramJual_plus(){
        var nilaiTransaksiStr = $('#id_saleInGram').val();
        var gram_plus = 0.5;
        var hargajualreal = <%= @hargaBeli.to_i * 100 %>;
       
        if(nilaiTransaksiStr == '10'){
            var total = parseFloat(nilaiTransaksiStr);
            var hargaJualEmas = parseFloat(total) *parseFloat(hargajualreal);
        }else{
            var total = parseFloat(nilaiTransaksiStr) + gram_plus;
            var hargaJualEmas = parseFloat(total) *parseFloat(hargajualreal);
            

        }
        // alert(total);
       
        $('#id_saleInGram').val(total);
        $("#id_saleInRupiah").val(formatRupiah(hargaJualEmas.toString(), ""));
        $('#lbl_saleGram').text(total+' Gr');
        $("#lbl_saleRupiah").text("Rp. "+formatRupiah(hargaJualEmas.toString(), ""));
        
        


       

    }
    

    //================================= jual emas =====================================================



</script>