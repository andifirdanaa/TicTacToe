<!-- <script src="toastr.js"></script> -->
<script>
    $('#plafond_id').hide();
    $('#detail_pengajuan_backend').hide();
    $('#detail_pengajuan_pass').hide();
    $('#divPassID').hide();
    $('#sms_opt_div').hide();
    $('#layout_pass').hide();
    $('#layout_sukses_gagal').hide();
    $('#value_slider').show();
    $('#lanjut_pengajuan_simu').hide();


    readyToStart();

    $(document).ready(function () {

        $('#deal_ganti_nmr').hide();
        $('#deal_ganti_nmrx').hide();
        $('#sukses_digi').hide();
        $('#sukses_exdigi').hide();


        var abc = <%= @data['data']['status'] %>;
        var untkerja = '<%= @data['data']['unit_kerja'] %>';
        var det_nama = '<%= @data['data']['nama'] %>';
        var det_nip = '<%= @data['data']['nip'] %>';
        var det_jbtn = '<%= @data['data']['jabatan'] %>';
        var det_aktif_ataukagak = '<%= @cek_status_pengajuan['status']%>';

        var absensiid_is_present = <%= @cek_pengajuan_ku['status']%>;


        // Cek Aktif Atau Nggak


        if (!absensiid_is_present){
            $('#pengajuan_notallowed').show();
            $('#pengajuan_allow').hide();
            $('#gaboleminjem').show();
            $('#ada_histori').hide();
            return false
        }

        if (det_aktif_ataukagak == '1' ){


            $('#pengajuan_allow').show();
            $('#pengajuan_notallowed').hide();

            if (abc == 1){

                $('#pengajuan_allow').show();
                $('#pengajuan_notallowed').hide();

            } else {

                $('#pengajuan_notallowed').show();
                $('#pengajuan_allow').hide();

                $('#gaboleminjem').show();
                $('#ada_histori').hide();

            }

                // pengajuan_allow pengajuan_notallowed

                if ('<%= @datahistori.count %>' >= 1) {

                var yyxc = $('#detail_historiii').val();


                if(yyxc == 'pending' || yyxc == 'disetujui' || yyxc == 'sudah_pencairan'  ){

                    $('#pengajuan_notallowed').show();
                    $('#pengajuan_allow').hide();

                    $('#gaboleminjem').hide();
                    $('#ada_histori').show()

                } else {

                    $('#pengajuan_allow').show();
                    $('#pengajuan_notallowed').hide();

                }



                } else {

                    $('#pengajuan_allow').show();
                    $('#pengajuan_notallowed').hide();
                }

                // Kalau Di System Setting nonaktif

                if (det_nama == "NotFound" || untkerja == "-" || det_nip == "NotFound" || det_jbtn == "NotFound"){

                    $('#pengajuan_notallowed').show();
                    $('#pengajuan_allow').hide();

                    $('#gaboleminjem').show();
                    $('#ada_histori').hide();


                }

        } else{

            $('#pengajuan_notallowed').show();
            $('#pengajuan_allow').hide();
            $('#gaboleminjem').show();
            $('#ada_histori').hide();

        }

       

         var maxdigi = <%= @maxpnmdigi.to_f %>;
         var tot_wallet = <%= @data_wallet.to_f %> + 500000;
   
        if(tot_wallet > maxdigi ){
            $('#max_cek_limit_digi').hide()
            $('#max_cek_limit_digix').hide()
            $('#pilihan_bayarby').val("3");
        } else {
            $('#max_cek_limit_digi').show()
            $('#max_cek_limit_digix').show()
        }
        

       

        var rupiah = document.getElementById("slider_os");
        rupiah.addEventListener("keyup", function(e) {
        // tambahkan 'Rp.' pada saat form di ketik
        // gunakan fungsi formatRupiah() untuk mengubah angka yang di ketik menjadi format angka
        rupiah.value = formatRupiah(this.value, "Rp. ");
        });


        $('#det_bank').hide();
        $('#det_wallet').hide();
        $('#det_linkaja').hide();

        var slider = document.getElementById("slider_os");

        var nilaiminslider = slider.value;

        $('#value_slider').val(formatRupiah(nilaiminslider, "Rp. "))
        // output.innerHTML = slider.value;
        var tot_pinj = $('#value_slider').val()
        var numtot = tot_pinj.replace(/[^0-9]/g,'');
        $('#value_slider2').val(numtot);
        

        var jml_saldo_pdnmdigi = <%= @data_wallet.to_i %> ;

        slider.oninput = function () {

            var tot_digi = parseInt(jml_saldo_pdnmdigi) + parseInt(this.value) ;
            var maxdigi = <%= @maxpnmdigi.to_f %>;

            if(this.value > maxdigi ){
                $('#max_cek_limit_digi').hide()
                $('#max_cek_limit_digix').hide()
                $('#pilihan_bayarby').val("3");
            } else {
                $('#max_cek_limit_digi').show()
                $('#max_cek_limit_digix').show()
            }


            if(tot_digi > maxdigi ){
                $('#max_cek_limit_digi').hide()
                $('#max_cek_limit_digix').hide()
                $('#pilihan_bayarby').val("3");
            } else{
                $('#max_cek_limit_digi').show()
                $('#max_cek_limit_digix').show()
            }
                
            

            $('#value_slider').show();
            $('#value_slider').val(formatRupiah(this.value, "Rp. "));

            // output.innerHTML = formatRupiah(this.value, "Rp. ");
            var tot_pinj = $('#value_slider').val()
            var numtot = tot_pinj.replace(/[^0-9]/g,'');
            $('#value_slider2').val(numtot);
        }   

    

      


        // PILIHAN LENDER

        $(".toggle-password").click(function() {

            $(this).toggleClass("fa-eye fa-eye-slash");
            var input = $($(this).attr("toggle"));
            if (input.attr("type") == "password") {
                input.attr("type", "text");
            } else {
                input.attr("type", "password");
            }
        });


        // Add active class to the current button (highlight it)
        // var header = document.getElementById("myDIV");
        // var btns = header.getElementsByClassName("btnlender");
        // for (var i = 0; i < btns.length; i++) {
        //     btns[i].addEventListener("click", function () {
        //         var current = document.getElementsByClassName("active");
        //         if (current.length > 0) {
        //             current[0].className = current[0].className.replace(" active", "");
        //         }
        //         this.className += " active";
        //     });
        // }

        

    });


    function chooseLender(lenketid, lendid){


        if( lenketid == 'lend_syar_id'){

            $('#pilihan_lend').val(lendid);
            var a = 'color'+lendid;
            var ax = document.getElementById(a);
            var ay = document.getElementById("color2");

            if (ay == null){

            }else{
                ay.style.backgroundColor = "white";  
            }
            ax.style.backgroundColor = "lightblue";
            

        }else if ( lenketid == 'lend_konve_id' ){

            $('#pilihan_lend').val(lendid);
            var a = 'color'+lendid;
            var ax = document.getElementById(a);
            var ay = document.getElementById("color1");

            if(ay == null){

            }else{
                ay.style.backgroundColor = "white";
            }

            document.getElementById(a).style.backgroundColor = "lightblue";
            

        }else{

            $('#pilihan_lend').val('0');
            var a = 'color'+lendid;
            var ax = document.getElementById(a);
            var ay = document.getElementById("color1");

            if( ay == null){

            }else{
                ay.style.backgroundColor = "white";
            }

            if(ax == null){

            }else{
                ax.style.backgroundColor = "white";
            }
            
            

        }

    }



      /* Fungsi formatRupiah */
    function formatRupiah(angka, prefix) {
    var number_string = angka.replace(/[^,\d]/g, "").toString(),
        split = number_string.split(","),
        sisa = split[0].length % 3,
        rupiah = split[0].substr(0, sisa),
        ribuan = split[0].substr(sisa).match(/\d{3}/gi);

    // tambahkan titik jika yang di input sudah menjadi angka ribuan
    if (ribuan) {
        separator = sisa ? "." : "";
        rupiah += separator + ribuan.join(".");
    }

    rupiah = split[1] != undefined ? rupiah + "," + split[1] : rupiah;
    return prefix == undefined ? rupiah : rupiah ? "Rp. " + rupiah : "";
    }

    function pilihLender(jns_lender){

        document.getElementById("jns_lender").style.backgroundColor='red';

        $('#pilihan_lend').val(jns_lender);

    }


    function cekPencairanBy(val){

        nohpx = '<%= session[params['userName']]['nohp'] %>';

        if ( val != nohpx  ){

            $('#deal_ganti_nmr').show();
            $('#deal_ganti_nmrx').show();
            $('#no_hp_link').val(val);

        } else {
            $('#deal_ganti_nmr').hide();
            $('#deal_ganti_nmrx').hide();
            $('#no_hp_link').val(nohpx);

        }

    }

    function cekInputManual(val){

        var numtot = val.replace(/[^0-9]/g,'');
        $('#value_slider').val(formatRupiah(numtot, "Rp. "));
        $('#value_slider2').val(numtot);
        var max_plaf = '<%= @data['data']['plafond'] %> ';

        var bbb = parseFloat(numtot);
        var ccc = bbb / 100000;

        if(parseFloat(numtot) > parseFloat(max_plaf) ){

            toastr.error('Pinjaman yang anda input melebihi Maksimal Plafond yang tersedia .!!' , 'Error!');
            $('#value_slider').val("Rp. 500.000");
            return false;
            
        } else {

        }

        var aaaa = Number.isInteger(ccc)

        if (aaaa == true ){

        } else {
            toastr.error('Jumlah pinjaman harus keliapan \n Rp. 100.000', 'Error!');
            $('#value_slider').val("Rp. 500.000");
            return false;
        }

    }

 
    function readyToStart() {
        $(".nomor").val("0.00");
        $(".nomor").focusout(function () {
            if ($(this).val() == '') {
                $(this).val('0.00');
            } else {
                var angka = $(this).val();
                $(this).val(number_format(angka, 2));
            }
        });

        $(".nomor1").val("0");

    }

    function checkPnmDigi(xx){


        if(xx == true){
            $("#bnicheck_id").prop("checked", false);
            $('#linkaja_id').prop("checked", false);
            $('#det_bank').hide();
            $('#det_wallet').show();
            $('#det_linkaja').hide();
            $('#pilihan_bayarby').val("1");

        } else{
            $("#bnicheck_id").prop("checked", false);
            $("#wallet_id").prop("checked", false);
            $('#linkaja_id').prop("checked", false);
            $('#det_bank').hide();
            $('#det_wallet').hide();
            $('#pilihan_bayarby').val("3");
        }
    }

    function checkBank(xx){

        if(xx == true){
            $('#linkaja_id').prop("checked", false);
            $("#wallet_id").prop("checked", false);
            $('#det_bank').show();
            $('#det_wallet').hide();
            $('#det_linkaja').hide();
            $('#pilihan_bayarby').val("0");

        } else{
            $("#bnicheck_id").prop("checked", false);
            $("#wallet_id").prop("checked", false);
            $('#linkaja_id').prop("checked", false);
            $('#det_bank').hide();
            $('#det_wallet').hide();
            $('#pilihan_bayarby').val("3");
        }
        
    }

    function checkLinkAja(xx){

        if(xx == true){
            $("#wallet_id").prop("checked", false);
            $("#bnicheck_id").prop("checked", false);
            $('#det_bank').hide();
            $('#det_linkaja').show();
            $('#det_wallet').hide();
            $('#pilihan_bayarby').val("2");

        } else{
            $("#bnicheck_id").prop("checked", false);
            $("#wallet_id").prop("checked", false);
            $('#linkaja_id').prop("checked", false);
            $('#det_bank').hide();
            $('#det_wallet').hide();
            $('#pilihan_bayarby').val("3");
        }

    }

    function chooseTujuanPencairan(val){

        // alert(val)

        if( val == 'PnmDigi'){
            $("#wallet_id").prop("checked", true);
            $("#bnicheck_id").prop("checked", false);
            $('#linkaja_id').prop("checked", false);
            $('#det_bank').hide();
            $('#det_wallet').show();
            $('#det_linkaja').hide();
            $('#pilihan_bayarby').val("1");

            var warna_digi = document.getElementById("max_cek_limit_digix");
            var warna_bank = document.getElementById("bankcol");
            var warna_linkaja = document.getElementById("linkcol");

            if (warna_bank == null){

            }else {
                warna_bank.style.backgroundColor = "white";
            }

            if (warna_linkaja == null ){

            }else {
                warna_linkaja.style.backgroundColor = "white";
            }

            warna_digi.style.backgroundColor = "lightblue";
            

        } else if( val == 'Bank'){

            $("#wallet_id").prop("checked", false);
            $("#bnicheck_id").prop("checked", true);
            $('#linkaja_id').prop("checked", false);
            $('#det_bank').show();
            $('#det_wallet').hide();
            $('#det_linkaja').hide();
            $('#pilihan_bayarby').val("0");

            var warna_digi = document.getElementById("max_cek_limit_digix");
            var warna_bank = document.getElementById("bankcol");
            var warna_linkaja = document.getElementById("linkcol");

            if (warna_digi == null){

            }else {
                warna_digi.style.backgroundColor = "white";
            }

            if (warna_linkaja == null ){

            }else {
                warna_linkaja.style.backgroundColor = "white";
            }

            warna_bank.style.backgroundColor = "lightblue";

        } else if ( val == 'LinkAja'){

            $("#wallet_id").prop("checked", false);
            $("#bnicheck_id").prop("checked", false);
            $('#linkaja_id').prop("checked", true);
            $('#det_bank').hide();
            $('#det_wallet').hide();
            $('#det_linkaja').show();
            $('#pilihan_bayarby').val("2");

            var warna_digi = document.getElementById("max_cek_limit_digix");
            var warna_bank = document.getElementById("bankcol");
            var warna_linkaja = document.getElementById("linkcol");

            if (warna_bank == null){

            }else {
                warna_bank.style.backgroundColor = "white";
            }

            if (warna_digi == null){

            }else {
                warna_digi.style.backgroundColor = "white";
            }

            warna_linkaja.style.backgroundColor = "lightblue";
        }
    }


    function number_format(number, decimals, dec_point, thousands_sep) {
        number = (number + '').replace(/[^0-9+\-Ee.]/g, '');
        var n = !isFinite(+number) ? 0 : +number,
            prec = !isFinite(+decimals) ? 0 : Math.abs(decimals),
            sep = (typeof thousands_sep === 'undefined') ? ',' : thousands_sep,
            dec = (typeof dec_point === 'undefined') ? '.' : dec_point,
            s = '',
            toFixedFix = function (n, prec) {
                var k = Math.pow(10, prec);
                return '' + Math.round(n * k) / k;
            };
        // Fix for IE parseFloat(0.55).toFixed(0) = 0;
        s = (prec ? toFixedFix(n, prec) : '' + Math.round(n)).split('.');
        if (s[0].length > 3) {
            s[0] = s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g, sep);
        }
        if ((s[1] || '').length < prec) {
            s[1] = s[1] || '';
            s[1] += new Array(prec - s[1].length + 1).join('0');
        }
        return s.join(dec);
    }

    function nextFunct() {
        $('#pengajuan_id').hide();
        $('#plafond_id').show();
    }

    function backFunct() {
        $('#pengajuan_id').show();
        $('#plafond_id').hide();
    }

    

    function submitFunct() {
        //var myformn = $('#form_pengajuan_id').serializeArray();

        //CEK LAGI
        var val = $('#value_slider2').val();
        var numtot = val.replace(/[^0-9]/g,'');
        $('#value_slider').val(formatRupiah(numtot, "Rp. "));
        $('#value_slider2').val(numtot);
        var max_plaf = '<%= @data['data']['plafond'] %> ';

        var bbb = parseFloat(numtot);
        var ccc = bbb / 100000;

        if(parseFloat(numtot) > parseFloat(max_plaf) ){

            toastr.error('Pinjaman yang anda input melebihi Maksimal Plafond yang tersedia .!!' , 'Error!');
            $('#value_slider').val("Rp. 500.000");
            return false;
            
        } else {

        }

        var aaaa = Number.isInteger(ccc)

        if (aaaa == true ){

        } else {
            toastr.error('Jumlah pinjaman harus keliapan \n Rp. 100.000', 'Error!');
            $('#value_slider').val("Rp. 500.000");
            return false;
        }
        //END CEK LAGI


        // Tanggal Transaksi


        var today = new Date();
        var dd = today.getDate();

        var mm = today.getMonth()+1; 
        var yyyy = today.getFullYear();
        if(dd<10) 
        {
            dd='0'+dd;
        } 

        if(mm<10) 
        {
            mm='0'+mm;
        }
        // END

        var nama = '<%= session[params['userName']]['nama'] %>';
        var nip = '<%= @data['data']['nip'] %>';
        var absensiid = '<%= @data['data']['absensiid'] %>';
        var jabatan = '<%= @data['data']['jabatan'] %>';
        var unit_kerja = '<%= @data['data']['unit_kerja'] %>';
        var plafond = "";

        var numtot = $("#value_slider2").val();
        var max_plaf = '<%= @data['data']['plafond'] %> ';

        if(parseFloat(numtot) > parseFloat(max_plaf) ){

            toastr.error('Pinjaman yang anda input melebihi Maksimal Plafond yang tersedia .!!' , 'Error!');
            return false;

        $('#value_slider').val("Rp. 500.000");

            return false;

        } else {
            plafond = $("#value_slider2").val();
        }



        var lenderid = $("#pilihan_lend").val();
        var jenis_pinjaman_det = "";
        var pilihan_bayarby_nya = $("#pilihan_bayarby").val();
        var namarek = "";
        var namabank = "";
        var tanggal_transaksi = yyyy+'-'+mm+'-'+dd;
        var status = 'pending';
        var userName = '<%=params['userName']%>';
        var password = '<%=params['password']%>';

        if(lenderid == 2 ){
            var jenis_pinjaman_det = $("#jenis_pinjaman_det").val("KONVENSIONAL");
        } else if(lenderid == 1 ) {
            var jenis_pinjaman_det = $("#jenis_pinjaman_det").val("SYARIAH");
        } else if(lenderid == 3 ) {
            toastr.error('Silahkan Pilih Lander : Syariah atau Konvensional ..!!', 'Error!') 
            return false; 
        }else{
            toastr.error('Silahkan Pilih Lander : Syariah atau Konvensional ..!!', 'Error!') 
            return false;  
        }

        
       

        if( pilihan_bayarby_nya == "1"){

            var namabank = "PNM Digi";
            var namarek = '<%= @data['data']['nama'] %>';
            var norek = '<%= session[params['userName']]['walletid'] %>';

        } else if( pilihan_bayarby_nya == "0"){
            var namarek = '<%= @data['data']['namarek'] %>';
            var namabank = '<%= @data['data']['namabank'] %>';
            var norek = '<%= @data['data']['norek'] %>';

        } else if (pilihan_bayarby_nya == "2"){

            var namabank = "LinkAja";
            var namarek = '<%= @data['data']['nama'] %>';
            var norek = $('#no_linkaja_id').val();

        } else{

            toastr.error('Silahkan Pilih Tujuan Pencairan PNM Digi , Bank atau LinkAja', 'Error!')
            return false;
            
        }
            


        if (namabank == "PNM Digi"){

            $('#det_wallet_back').show();
            $('#det_bank_back').hide();
            $('#det_linkaja_back').hide();
            var via = "R";

        } else if (namabank == "LinkAja"){

            $('#det_wallet_back').hide();
            $('#det_linkaja_back').show();
            $('#det_bank_back').hide();
            var via = "G";

        } else{
            $('#det_wallet_back').hide();
            $('#det_linkaja_back').hide();
            $('#det_bank_back').show();
            var via = "G";
        }

        myLoadingAjax()


        $.ajax({

            url: '/my_template/submit_pengajuan' + "?userName=" + userName + "&password=" + password,
            type: 'POST',
            dataType: "json",
            data: {

                nama: nama,
                nip: nip,
                absensiid: absensiid,
                jabatan: jabatan,
                unit_kerja: unit_kerja,
                plafond: plafond,
                lenderid: lenderid,
                norek: norek,
                namarek: namarek,
                namabank: namabank,
                tanggal_transaksi: tanggal_transaksi,
                via:via,
                status: status

            },

            success: function (result) {
                console.log(result)
                if (result.status == true) {


                    $('#plafond_id').hide();
                    $('#detail_pengajuan_backend').show();

                    if (result.data.length == 3){
                        $("#biaya_admin").val(formatRupiah(result.data[0]['Nilai'].toString(), "Rp, "));
                        $("#biaya_asuransi_jiwa").val(formatRupiah(result.data[1]['Nilai'].toString(), "Rp, "));
                        $("#biaya_handling").val("0");
                        $("#biaya_jasa_margin").val(formatRupiah(result.data[2]['Nilai'].toString(), "Rp, "));

                        $("#biaya_adminy").val(result.data[0]['Nilai']);
                        $("#biaya_asuransi_jiway").val(result.data[1]['Nilai']);
                        $("#biaya_handlingy").val("0");
                        $("#biaya_jasa_marginy").val(result.data[2]['Nilai']);

                        var biaya_total = parseInt(result.data[0]['Nilai']) + parseInt(result.data[1]['Nilai']) + parseInt(result.data[2]['Nilai']);

                    } else{
                        $("#biaya_admin").val(formatRupiah(result.data[0]['Nilai'].toString(), "Rp, "));
                        $("#biaya_asuransi_jiwa").val(formatRupiah(result.data[1]['Nilai'].toString(), "Rp, "));
                        $("#biaya_handling").val(formatRupiah(result.data[2]['Nilai'].toString(), "Rp, "));
                        $("#biaya_jasa_margin").val(formatRupiah(result.data[3]['Nilai'].toString(), "Rp, "));


                        $("#biaya_adminy").val(result.data[0]['Nilai']);
                        $("#biaya_asuransi_jiway").val(result.data[1]['Nilai']);
                        $("#biaya_handlingy").val(result.data[2]['Nilai']);
                        $("#biaya_jasa_marginy").val(result.data[3]['Nilai']);

                        var biaya_total = parseInt(result.data[0]['Nilai']) + parseInt(result.data[1]['Nilai']) + parseInt(result.data[2]['Nilai']) + parseInt(result.data[3]['Nilai']);
                    }

                    var pengajuan = $("#value_slider2").val();                    
                    var pengajuan_det = $("#pengajuan_det").val(formatRupiah(pengajuan.toString(), "Rp. "));
                    var pinjamannya = $("#pengajuan_det").val();
                    var totalx = parseInt(pengajuan, 10) - biaya_total ;
                    var total_tagihan = $("#total_tagihan").val(formatRupiah(totalx.toString(), "Rp. "));



                } else {
                    toastr.error('Pengajuan Pinjaman Gagal', 'Error!');

                    var userName = "<%=params['userName']%>"
                    var password = "<%=params['password']%>"
                    window.location.href = "/?userName=" + userName + "&password=" + password;

                }


            }

        });

        //console.log(myformn);
    }


    function submitFunctPassword(){

        $('#detail_pengajuan_backend').hide();

        var lenderid = $("#pilihan_lend").val();
        if(lenderid == 2 ){

            $('#termKopkar_id').show();

        } else if(lenderid == 1 ) {

            $('#termBmt_id').show();

        } else  {

            $('#termKopkar_id').show();

        }
        $('#detail_pengajuan_pass').show();

    }

    $('#agree_id').change(function() {
        if ($(this).is(":checked")) {
            //$('#btnBeli_id').show();
            $('#divPassID').show();
        } else {
            //$('#btnBeli_id').hide();
            $('#divPassID').hide();
        }
    });

    $("#tidaksetuju_id").click(function(){
     

        var userName = '<%=params['userName']%>';
        var password = '<%=params['password']%>';
        myLoadingAjax()
        $.ajax({
            url: '/my_template/' + "home" + "?userName=" + userName + "&password=" + password,
            dataType: 'html',
            beforeSend: function () {

                //  $('.modal_json').fadeIn('fast');
            },
            success: function (data) {
                $('#mycontent').html(data)
                //  $('#myModal').modal('hide')
            },
            error: function () {
                $('#mycontent').html("")
            },
            complete: function () {}
        });

    });

    $("#back_tohome").click(function(){
     

        var userName = '<%=params['userName']%>';
        var password = '<%=params['password']%>';
        myLoadingAjax()
        $.ajax({
            url: '/my_template/' + "home" + "?userName=" + userName + "&password=" + password,
            dataType: 'html',
            beforeSend: function () {

                //  $('.modal_json').fadeIn('fast');
            },
            success: function (data) {
                $('#mycontent').html(data)
                //  $('#myModal').modal('hide')
            },
            error: function () {
                $('#mycontent').html("")
            },
            complete: function () {}
        });

    });

    

    $("#setuju_id").click(function(){
        $('#detail_pengajuan_pass').hide();
        $('#layout_pass').show();

    });

    $("#btn_confirm_pass").click(function() {
        {

            pass = $('#passDonasiID').val();
            $('#passDonasiID').focus();

            $('#textBeliBtn_id').html("harap tunggu ...")
            pass = $('#passDonasiID').val();

            if (pass == '') {

                
                $('#textBeliBtn_id').html("Lanjut")
                toastr.warning('Silahkan masukkan password transaksi..!', 'Warnning!!')
                return false;

            } else {
                var passSess = "<%= params[:password] %>"
                var userName = "<%= params['userName'] %>"
                myLoadingAjax()

                $.ajax({
                    type: 'GET',
                    url: '/my_template/encryptPass?userName='+userName+'&password='+passSess,
                    data: {
                        mypass: pass
                    },
                    dataType: 'json',
                    success: function(passEncryptCheck) {
                        var pss = passEncryptCheck.data;
                        console.log(passEncryptCheck)
                        res = pss.replace("+", " ");
                        console.log(res)

                        if (passSess == res) {

                            var userName = '<%=params['userName']%>';
                            var password = '<%=params['password']%>';
                            

                            // DATA LEMPAR

                            var today = new Date();
                            var dd = today.getDate();

                            var mm = today.getMonth()+1; 
                            var yyyy = today.getFullYear();
                            if(dd<10) 
                            {
                                dd='0'+dd;
                            } 

                            if(mm<10) 
                            {
                                mm='0'+mm;
                            }
                            // END

                            var nama = '<%= session[params['userName']]['nama'] %>';
                            var nip = '<%= @data['data']['nip'] %>';
                            var absensiid = '<%= @data['data']['absensiid'] %>';
                            var jabatan = '<%= @data['data']['jabatan'] %>';
                            var unit_kerja = '<%= @data['data']['unit_kerja'] %>';
                            var plafond = $("#value_slider2").val();
                            var lenderid = $("#pilihan_lend").val();
                            var jenis_pinjaman_det = "";
                            var pilihan_bayarby_nya = $("#pilihan_bayarby").val();
                            var namarek = "";
                            var namabank = "";
                            var tanggal_transaksi = yyyy+'-'+mm+'-'+dd;
                            var status = 'pending';
                            var userName = '<%=params['userName']%>';
                            var password = '<%=params['password']%>';
                            var nocif = '<%= session[params['userName']]['nocif']%>';

                            namakar

                            var namakar = $('#namakar').val();
                            
                            var biaya_jasa =  $("#biaya_jasa_marginy").val();
                            var biaya_administrasi = $("#biaya_adminy").val();
                            var biaya_asuransi = $("#biaya_asuransi_jiway").val();
                            var biaya_transfer = $("#biaya_handlingy").val();
                            var perusahaan = '<%= @data['data']['perusahaan'] %>';

                            // alert(perusahaan);
                            // return false;

                 
                            if(lenderid == 2 ){
                                var jenis_pinjaman_det = $("#jenis_pinjaman_det").val("KONVENSIONAL");
                            } else if(lenderid == 1 ) {
                                var jenis_pinjaman_det = $("#jenis_pinjaman_det").val("SYARIAH");
                            } else if(lenderid == 3 ) {
                               
                            }else{
                             
                            }
                            
                        
                        if( pilihan_bayarby_nya == "1"){

                                var namabank = "PNM Digi";
                                var namarek = '<%= @data['data']['nama'] %>';
                                var norek = '<%= session[params['userName']]['walletid'] %>';
                                $('#sukses_digi').hide();
                                $('#sukses_exdigi').show();

                            } else if( pilihan_bayarby_nya == "0"){
                                var namarek = '<%= @data['data']['namarek'] %>';
                                var namabank = '<%= @data['data']['namabank'] %>';
                                var norek = '<%= @data['data']['norek'] %>';
                                $('#sukses_digi').hide();
                                $('#sukses_exdigi').show();
                                
                            } else if (pilihan_bayarby_nya == "2"){

                                var namabank = "LinkAja";
                                var namarek = '<%= @data['data']['nama'] %>';
                                var norek = $('#no_hp_link').val();

                                $('#sukses_digi').show();
                                $('#sukses_exdigi').hide();

                            } else{

                                $('#sukses_digi').hide();
                                $('#sukses_exdigi').show();
                                
                            }
                                
                            if (namabank == "PNM Digi"){
                                var via = "R";
                            } else{
                                var via = "G";
                            }


                            // END DATA LEMPAR 
                            myLoadingAjax()


                            // START SKIP OTP

                            $.ajax({
    
                                url: '/my_template/transaksis' + "?userName=" + userName + "&password=" + password,
                                type: 'POST',
                                dataType: "json",
                                data: {

                                    nama: nama,
                                    nip: nip,
                                    absensiid: absensiid,
                                    jabatan: jabatan,
                                    unit_kerja: unit_kerja,
                                    plafond: plafond,
                                    lenderid: lenderid,
                                    norek: norek,
                                    namarek: namarek,
                                    namabank: namabank,
                                    tanggal_transaksi: tanggal_transaksi,
                                    via:via,
                                    status: status,
                                    nocif: nocif,
                                    biaya_jasa: biaya_jasa,
                                    biaya_administrasi:biaya_administrasi,
                                    biaya_asuransi:biaya_asuransi,
                                    biaya_transfer:biaya_transfer,
                                    perusahaan: perusahaan
                                

                                },

                                success: function (result) {
                                    // console.log(result)
                                    // return false
                                    if (result.status == true) {

                                        $('#layout_pass').hide();
                                        $('#layout_sukses_gagal').show();

                                        if ( pilihan_bayarby_nya == "1"){

                                            $('#sukses_digi').hide();
                                            $('#sukses_exdigi').show();

                                        } else if( pilihan_bayarby_nya == "0"){

                                            $('#sukses_digi').hide();
                                            $('#sukses_exdigi').show();

                                        } else if (pilihan_bayarby_nya == "2"){

                                            $('#sukses_digi').show();
                                            $('#sukses_exdigi').hide();

                                        } else{

                                            $('#sukses_digi').hide();
                                            $('#sukses_exdigi').show();

                                        }

                                    } else {
                                        toastr.error('Pengajuan Pinjaman Gagal', 'Error!');

                                        var userName = "<%=params['userName']%>"
                                        var password = "<%=params['password']%>"
                                       window.location.href = "/?userName=" + userName + "&password=" + password;

                                    }


                                }

                            });


                            // END SKIP OTP


                            // START PAKE OTP
                            //var gab_data ="&nama="+nama+"&nip="+nip+"&absensiid="+absensiid+"&jabatan="+jabatan+"&unit_kerja="+unit_kerja+"&plafond="+plafond+"&lenderid="+lenderid+"&norek="+norek+"&namarek="+namarek+"&namabank="+namabank+"&tanggal_transaksi="+tanggal_transaksi+"&via="+via+"&status="+status+"&nocif="+nocif+"&biaya_jasa="+biaya_jasa+"&biaya_administrasi="+biaya_administrasi+"&biaya_asuransi="+biaya_asuransi+"&biaya_transfer="+biaya_transfer;

                            //location.href="/my_template/" + "smsotp" + "?userName=" + userName + "&password=" + password+gab_data;

                            // END PAKE OTP
             
                
                        } else {
                            
                            $('#textBeliBtn_id').html("Lanjut")
                            toastr.error('Oops, sepertinya anda salah memasukan password', 'Error!!')
                            return false;
                    
                        }

                    }
                });
            }

        }
    });



    function submit_pengajuan(){

        var today = new Date();
        var dd = today.getDate();

        var mm = today.getMonth()+1; 
        var yyyy = today.getFullYear();
        if(dd<10) 
        {
            dd='0'+dd;
        } 

        if(mm<10) 
        {
            mm='0'+mm;
        }
        // END

        var nama = '<%= session[params['userName']]['nama'] %>';
        var nip = '<%= @data['data']['nip'] %>';
        var absensiid = '<%= @data['data']['absensiid'] %>';
        var jabatan = '<%= @data['data']['jabatan'] %>';
        var unit_kerja = '<%= @data['data']['unit_kerja'] %>';
        var plafond = $("#value_slider2").val();
        var lenderid = $("#pilihan_lend").val();
        var jenis_pinjaman_det = "";
        var pilihan_bayarby_nya = $("#pilihan_bayarby").val();
        var namarek = "";
        var namabank = "";
        var tanggal_transaksi = yyyy+'-'+mm+'-'+dd;
        var status = 'pending';
        var userName = '<%=params['userName']%>';
        var password = '<%=params['password']%>';
        var nocif = '<%= session[params['userName']]['nocif']%>';

        var biaya_jasa = parseFloat($("#biaya_jasa_margin").val());
        var biaya_administrasi = parseFloat($("#biaya_admin").val());
        var biaya_asuransi = parseFloat($("#biaya_asuransi_jiwa").val());
        var biaya_transfer = parseFloat($("#biaya_handling").val());
        var perusahaan = '<%= @data['data']['perusahaan'] %>';


        if(lenderid == 2 ){
            var jenis_pinjaman_det = $("#jenis_pinjaman_det").val("KONVENSIONAL");
        } else if(lenderid == 1 ) {
            var jenis_pinjaman_det = $("#jenis_pinjaman_det").val("SYARIAH");
        } else if(lenderid == 3 ) {
            toastr.error('Silahkan Pilih Lander : Syariah atau Konvensional ..!!', 'Error!') 
            return false; 
        }else{
            toastr.error('Silahkan Pilih Lander : Syariah atau Konvensional ..!!', 'Error!') 
            return false;  
        }
        
       
        if( pilihan_bayarby_nya == "1"){

            var namabank = "PNM Digi";
            var namarek = '<%= @data['data']['nama'] %>';
            var norek = '<%= session[params['userName']]['walletid'] %>';

        } else if( pilihan_bayarby_nya == "0"){
            var namarek = '<%= @data['data']['namarek'] %>';
            var namabank = '<%= @data['data']['namabank'] %>';
            var norek = '<%= @data['data']['norek'] %>';
        } else{
            
        }
            
        if (namabank == "PNM Digi"){
            var via = "R";
        } else{
            var via = "G";
        }

        myLoadingAjax()


        $.ajax({

            url: '/my_template/transaksis' + "?userName=" + userName + "&password=" + password,
            type: 'POST',
            dataType: "json",
            data: {

                nama: nama,
                nip: nip,
                absensiid: absensiid,
                jabatan: jabatan,
                unit_kerja: unit_kerja,
                plafond: plafond,
                lenderid: lenderid,
                norek: norek,
                namarek: namarek,
                namabank: namabank,
                tanggal_transaksi: tanggal_transaksi,
                via:via,
                status: status,
                nocif: nocif,
                biaya_jasa: biaya_jasa,
                biaya_administrasi:biaya_administrasi,
                biaya_asuransi:biaya_asuransi,
                biaya_transfer:biaya_transfer,
                perusahaan: perusahaan
               

            },

            success: function (result) {
                console.log(result)
                if (result.status == true) {

                    $('#sms_opt_div').hide();
                    $('#layout_sukses_gagal').show();

                } else {
                    toastr.error('Pengajuan Pinjaman Gagal', 'Error!');

                    var userName = "<%=params['userName']%>"
                    var password = "<%=params['password']%>"
                    window.location.href = "/?userName=" + userName + "&password=" + password;

                }


            }

        });

    }
</script>